<!DOCTYPE html>
<html>
<head>
  <title>RemindMe - Dates</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css">
</head>
<body>
  <header>
    <h2>üéÇ Your Birthday Reminders</h2>
    <button onclick="logout()">Logout</button>
  </header>

  <main class="container">
    <form id="birthdayForm">
      <input type="text" id="name" placeholder="Name" required />
      <input type="date" id="date" required />
      <button type="submit">Add Birthday</button>
    </form>

    <hr/>

    <ul id="birthdayList"></ul>
  </main>

  <script>
    const airtableApiKey = "patvZfxpDZOYbjS27.dc2df00ca0e49de14030866cf08b05111606b9c79ad1f3d7a436a7bd697617ab"; // TEMP ‚Äî replace for prod
    const baseId = "YOUR_BASE_ID_HERE"; // e.g. "appABC123XYZ"
    const tableName = "birthdays";
    const apiURL = `https://api.airtable.com/v0/${baseId}/${tableName}`;
    const email = localStorage.getItem("userEmail");

    if (!email) {
      window.location.href = "login.html";
    }

    function logout() {
      localStorage.removeItem("userEmail");
      window.location.href = "login.html";
    }

    async function loadBirthdays() {
      const res = await fetch(`${apiURL}?filterByFormula=${encodeURIComponent(`email="${email}"`)}`, {
        headers: {
          Authorization: `Bearer ${airtableApiKey}`
        }
      });
      const data = await res.json();

      const list = document.getElementById("birthdayList");
      list.innerHTML = "";
      data.records.forEach(record => {
        const { name, date } = record.fields;
        const id = record.id;
        const li = document.createElement("li");
        li.innerHTML = `
          ${name} ‚Äî ${date}
          <button onclick="deleteBirthday('${id}')">‚ùå</button>
        `;
        list.appendChild(li);
      });
    }

    async function deleteBirthday(id) {
      await fetch(`${apiURL}/${id}`, {
        method: "DELETE",
        headers: {
          Authorization: `Bearer ${airtableApiKey}`
        }
      });
      loadBirthdays();
    }

    document.getElementById("birthdayForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const date = document.getElementById("date").value;

      await fetch(apiURL, {
        method: "POST",
        headers: {
          Authorization: `Bearer ${airtableApiKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          fields: {
            email,
            name,
            date
          }
        })
      });

      document.getElementById("birthdayForm").reset();
      loadBirthdays();
    });

    loadBirthdays();
  </script>
</body>
</html>
